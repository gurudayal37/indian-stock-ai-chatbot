<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>All Time High Breakout Stocks - Indian Stock AI</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .hero-section {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            padding: 3rem 0;
        }
        .strategy-card {
            background: white;
            border-radius: 15px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s, box-shadow 0.3s;
        }
        .strategy-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.15);
        }
        .breakout-indicator {
            background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-weight: 600;
            font-size: 0.9rem;
        }
        .price-change-positive { color: #28a745; font-weight: 600; }
        .price-change-negative { color: #dc3545; font-weight: 600; }
        .stock-link {
            color: #007bff;
            text-decoration: none;
            font-weight: 500;
        }
        .stock-link:hover {
            color: #0056b3;
            text-decoration: underline;
        }
        .loading-spinner {
            display: none;
        }
    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
        <div class="container">
            <a class="navbar-brand" href="/">
                <i class="fas fa-chart-line me-2"></i>
                Indian Stock AI
            </a>
            <div class="navbar-nav ms-auto">
                <a class="nav-link" href="/">
                    <i class="fas fa-home me-1"></i>Home
                </a>
                <a class="nav-link" href="/all-stocks-list">
                    <i class="fas fa-list me-1"></i>All Stocks
                </a>
            </div>
        </div>
    </nav>

    <!-- Hero Section -->
    <div class="hero-section">
        <div class="container text-center">
            <h1 class="display-4 fw-bold mb-3">
                <i class="fas fa-rocket me-3"></i>All Time High Breakout Strategy
            </h1>
            <p class="lead mb-4">Identify stocks breaking through their all-time highs with strong momentum and volume confirmation</p>
            <div class="row justify-content-center">
                <div class="col-md-8">
                    <div class="alert alert-light" role="alert">
                        <h5 class="alert-heading">Strategy Overview</h5>
                        <p class="mb-0">This strategy identifies stocks that are breaking through their 52-week or all-time highs with strong volume and momentum. These breakouts often signal continued upward price movement as new buyers enter the market.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="container my-5">
        <!-- Strategy Details -->
        <div class="row mb-5">
            <div class="col-lg-8">
                <div class="strategy-card p-4">
                    <h4 class="mb-3">Strategy Criteria</h4>
                    <div class="row">
                        <div class="col-md-6">
                            <h6><i class="fas fa-chart-line text-primary me-2"></i>Price Action</h6>
                            <ul class="list-unstyled">
                                <li>• Stock price near or at 52-week high</li>
                                <li>• Breaking above resistance levels</li>
                                <li>• Strong upward momentum</li>
                            </ul>
                        </div>
                        <div class="col-md-6">
                            <h6><i class="fas fa-volume-up text-primary me-2"></i>Volume Confirmation</h6>
                            <ul class="list-unstyled">
                                <li>• Above-average trading volume</li>
                                <li>• Volume spike on breakout day</li>
                                <li>• Sustained volume increase</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-lg-4">
                <div class="strategy-card p-4">
                    <h5 class="mb-3">Key Metrics</h5>
                    <div class="d-flex justify-content-between mb-2">
                        <span>Breakout Strength:</span>
                        <span class="fw-bold text-success">High</span>
                    </div>
                    <div class="d-flex justify-content-between mb-2">
                        <span>Risk Level:</span>
                        <span class="fw-bold text-warning">Medium</span>
                    </div>
                    <div class="d-flex justify-content-between mb-2">
                        <span>Time Horizon:</span>
                        <span class="fw-bold text-info">Short to Medium</span>
                    </div>
                    <div class="d-flex justify-content-between">
                        <span>Success Rate:</span>
                        <span class="fw-bold text-success">65-75%</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Filters -->
        <div class="strategy-card p-4 mb-4">
            <h5 class="mb-3">Filter Breakout Stocks</h5>
            <div class="row g-3">
                <div class="col-md-3">
                    <label for="minVolume" class="form-label">Min Volume (Lakhs)</label>
                    <input type="number" class="form-control" id="minVolume" placeholder="10" value="10">
                </div>
                <div class="col-md-3">
                    <label for="minChange" class="form-label">Min Change %</label>
                    <input type="number" class="form-control" id="minChange" placeholder="2" value="2">
                </div>
                <div class="col-md-3">
                    <label for="sectorFilter" class="form-label">Sector</label>
                    <select class="form-select" id="sectorFilter">
                        <option value="">All Sectors</option>
                    </select>
                </div>
                <div class="col-md-3">
                    <label for="sortBy" class="form-label">Sort By</label>
                    <select class="form-select" id="sortBy">
                        <option value="change_percent">Change %</option>
                        <option value="volume">Volume</option>
                        <option value="market_cap">Market Cap</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- Loading Spinner -->
        <div class="text-center loading-spinner" id="loadingSpinner">
            <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Loading...</span>
            </div>
            <p class="mt-2">Analyzing breakout stocks...</p>
        </div>

        <!-- Results -->
        <div id="resultsContainer" style="display: none;">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h5>Breakout Stocks Found: <span id="resultsCount" class="badge bg-primary">0</span></h5>
                <button class="btn btn-outline-primary" onclick="refreshData()">
                    <i class="fas fa-sync-alt me-1"></i>Refresh
                </button>
            </div>
            
            <div class="row" id="stocksContainer">
                <!-- Breakout stocks will be loaded here -->
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        let allStocks = [];
        let breakoutStocks = [];

        // Load stocks on page load
        document.addEventListener('DOMContentLoaded', function() {
            loadStocks();
            loadSectors();
            setupEventListeners();
        });

        async function loadStocks() {
            showLoading(true);
            try {
                const response = await fetch('/api/stocks?limit=1000');
                allStocks = await response.json();
                findBreakoutStocks();
            } catch (error) {
                console.error('Error loading stocks:', error);
                alert('Error loading stocks data. Please try again.');
            } finally {
                showLoading(false);
            }
        }

        async function loadSectors() {
            try {
                const response = await fetch('/api/sectors');
                const sectors = await response.json();
                
                const sectorSelect = document.getElementById('sectorFilter');
                sectors.forEach(sector => {
                    const option = document.createElement('option');
                    option.value = sector;
                    option.textContent = sector;
                    sectorSelect.appendChild(option);
                });
            } catch (error) {
                console.error('Error loading sectors:', error);
            }
        }

        function setupEventListeners() {
            document.getElementById('minVolume').addEventListener('input', filterBreakoutStocks);
            document.getElementById('minChange').addEventListener('input', filterBreakoutStocks);
            document.getElementById('sectorFilter').addEventListener('change', filterBreakoutStocks);
            document.getElementById('sortBy').addEventListener('change', filterBreakoutStocks);
        }

        function findBreakoutStocks() {
            // Simulate breakout detection logic
            // In a real implementation, this would analyze price data and volume patterns
            breakoutStocks = allStocks.filter(stock => {
                const changePercent = stock.change_percent || 0;
                const volume = stock.volume || 0;
                const high52Week = stock.high_52_week || 0;
                const currentPrice = stock.current_price || 0;
                
                // Basic breakout criteria
                return changePercent > 2 && 
                       volume > 100000 && 
                       currentPrice > 0 && 
                       high52Week > 0 &&
                       (currentPrice / high52Week) > 0.95; // Within 5% of 52-week high
            });

            filterBreakoutStocks();
        }

        function filterBreakoutStocks() {
            const minVolume = parseFloat(document.getElementById('minVolume').value) || 0;
            const minChange = parseFloat(document.getElementById('minChange').value) || 0;
            const sectorFilter = document.getElementById('sectorFilter').value;
            const sortBy = document.getElementById('sortBy').value;

            let filtered = breakoutStocks.filter(stock => {
                const volume = (stock.volume || 0) / 100000; // Convert to lakhs
                const changePercent = stock.change_percent || 0;
                
                const matchesVolume = volume >= minVolume;
                const matchesChange = changePercent >= minChange;
                const matchesSector = !sectorFilter || stock.sector === sectorFilter;

                return matchesVolume && matchesChange && matchesSector;
            });

            // Sort stocks
            filtered.sort((a, b) => {
                let aValue = a[sortBy] || 0;
                let bValue = b[sortBy] || 0;

                if (typeof aValue === 'string') aValue = parseFloat(aValue) || 0;
                if (typeof bValue === 'string') bValue = parseFloat(bValue) || 0;

                return bValue - aValue; // Descending order
            });

            renderBreakoutStocks(filtered);
        }

        function renderBreakoutStocks(stocks) {
            const container = document.getElementById('stocksContainer');
            container.innerHTML = '';

            document.getElementById('resultsCount').textContent = stocks.length;
            document.getElementById('resultsContainer').style.display = 'block';

            stocks.forEach(stock => {
                const stockCard = createBreakoutStockCard(stock);
                container.appendChild(stockCard);
            });
        }

        function createBreakoutStockCard(stock) {
            const col = document.createElement('div');
            col.className = 'col-lg-4 col-md-6 mb-4';
            
            const currentPrice = stock.current_price || 0;
            const changePercent = stock.change_percent || 0;
            const changeClass = changePercent >= 0 ? 'price-change-positive' : 'price-change-negative';
            const volume = (stock.volume || 0) / 100000; // Convert to lakhs
            const high52Week = stock.high_52_week || 0;
            const breakoutStrength = high52Week > 0 ? ((currentPrice / high52Week) * 100).toFixed(1) : 0;
            
            col.innerHTML = `
                <div class="strategy-card h-100" onclick="window.location.href='/stock/${stock.nse_symbol || stock.bse_symbol}'">
                    <div class="card-body p-4">
                        <div class="d-flex justify-content-between align-items-start mb-3">
                            <div>
                                <h6 class="card-title mb-1 stock-link">${stock.name || 'N/A'}</h6>
                                <small class="text-muted">${stock.nse_symbol || stock.bse_symbol}</small>
                            </div>
                            <span class="breakout-indicator">Breakout</span>
                        </div>
                        
                        <div class="row text-center mb-3">
                            <div class="col-6">
                                <div class="fw-bold fs-5">₹${currentPrice.toLocaleString()}</div>
                                <div class="${changeClass}">
                                    ${changePercent >= 0 ? '+' : ''}${changePercent.toFixed(2)}%
                                </div>
                            </div>
                            <div class="col-6">
                                <div class="fw-bold">${volume.toFixed(1)}L</div>
                                <small class="text-muted">Volume</small>
                            </div>
                        </div>
                        
                        <div class="row text-center">
                            <div class="col-4">
                                <small class="text-muted">52W High</small>
                                <div class="fw-bold">₹${high52Week.toFixed(2)}</div>
                            </div>
                            <div class="col-4">
                                <small class="text-muted">Strength</small>
                                <div class="fw-bold text-success">${breakoutStrength}%</div>
                            </div>
                            <div class="col-4">
                                <small class="text-muted">P/E</small>
                                <div class="fw-bold">${stock.pe_ratio ? stock.pe_ratio.toFixed(1) : 'N/A'}</div>
                            </div>
                        </div>
                        
                        <div class="mt-3">
                            <span class="badge bg-secondary">${stock.sector || 'N/A'}</span>
                        </div>
                    </div>
                </div>
            `;
            
            return col;
        }

        function refreshData() {
            loadStocks();
        }

        function showLoading(show) {
            document.getElementById('loadingSpinner').style.display = show ? 'block' : 'none';
            document.getElementById('resultsContainer').style.display = show ? 'none' : 'block';
        }
    </script>
</body>
</html>

